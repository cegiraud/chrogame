/** * Created by Charles on 15/02/14. */// permet le stockage des données// ogameData =//     planets : {//         <planetCode> : {//             infos:{},//             resources: {//                 metal:{quantity:0,production:0,max:0},//                 cristal:{quantity:0,production:0,max:0},//                 deuterium:{quantity:0,production:0,max:0}//             },//             buildings : {},//             fleet : {},//             defense : {}//             }//         },//     search: {},//     flyingResources :{}// }var ogameData = localStorage.ogameData != undefined ? JSON.parse(localStorage.ogameData) : {};// la minuterie !var timer;//actualise la productionfunction actualizeProduction(){    if(ogameData.planets == undefined) return;    $.each(ogameData.planets, function(key, value){        $.each(value.resources, function(key, value){            value.quantity += value.production;        });    });    (function() {timer=setTimeout(actualizeProduction, 1000);})();}//mise à jour des donnéesfunction majdatas(type, planetCode, data){    if(ogameData == undefined){        ogameData = {};    }    if(planetCode == null){        ogameData[type] = data;    } else {        if(ogameData.planets == undefined){            ogameData.planets = {};        }        if(ogameData.planets[planetCode] == undefined){            ogameData.planets[planetCode] = {};        }        if(ogameData.planets[planetCode][type] == undefined){            ogameData.planets[planetCode][type] = {};        }        $.extend(ogameData.planets[planetCode][type], data);    }}//got a message from content scriptchrome.extension.onRequest.addListener(    function(request, sender, sendResponse) {        if(request.module != "core"){            return false;        }        if(request.method == "getOgameData"){            sendResponse(ogameData);            return;        }        majdatas(request.method, request.planetCode, request.data);        localStorage.ogameData = JSON.stringify(ogameData);        (function() {clearTimeout(timer);timer=setTimeout(actualizeProduction, 1000);})();    });