/** * Created by Charles on 15/02/14. */// permet le stockage des données//ogameData =//    {<userID> : {//         planets : {//             <planetCode> : {//                 infos:{},//                 resources: {//                     metal:{quantity:0,production:0,max:0},//                     cristal:{quantity:0,production:0,max:0},//                     deuterium:{quantity:0,production:0,max:0}//                 },//                 buildings : {},//                 fleet : {},//                 defense : {}//             }//         },//         search: {},//         flyingResources :{}//    }//}var ogameData = localStorage.ogameData != undefined ? JSON.parse(localStorage.ogameData) : {};var currentUserId = localStorage.currentUserId != undefined ? JSON.parse(localStorage.currentUserId) : {};// la minuterie !var timer;//actualise la productionfunction actualizeProduction(){    $.each(ogameData, function(id,ogameDataUser){        if(ogameDataUser.planets == undefined) return;        $.each(ogameDataUser.planets, function(key, value){            $.each(value.resources, function(key, value){                value.quantity += value.production;            });        });        (function() {clearTimeout(timer);timer=setTimeout(actualizeProduction, 1000);})();    });}//mise à jour des donnéesfunction majdatas(user, type, planetCode, data){    currentUserId = user;    if(ogameData == undefined){        ogameData = {};    }    if(ogameData[user] == undefined){        ogameData[user] = {};    }    var ogameDataUser = ogameData[user];    if(planetCode == null){        ogameDataUser[type] = data;    } else {        if(ogameDataUser.planets == undefined){            ogameDataUser.planets = {};        }        if(ogameDataUser.planets[planetCode] == undefined){            ogameDataUser.planets[planetCode] = {};        }        if(ogameDataUser.planets[planetCode][type] == undefined){            ogameDataUser.planets[planetCode][type] = {};        }        $.extend(ogameDataUser.planets[planetCode][type], data);    }}//got a message from content scriptchrome.extension.onRequest.addListener(    function(request, sender, sendResponse) {        if(request.module != "core"){            return false;        }        if(request.method == "getOgameData"){            sendResponse(ogameData[new String(currentUserId)]);            return;        }        majdatas(request.user ,request.method, request.planetCode, request.data);        localStorage.ogameData = JSON.stringify(ogameData);        localStorage.currentUserId = JSON.stringify(currentUserId);        (function() {clearTimeout(timer);timer=setTimeout(actualizeProduction, 1000);})();    });