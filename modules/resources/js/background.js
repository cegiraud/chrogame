/** * Created by Charles on 15/02/14. */var timer;var ogameResources = {    "metal":{"quantite":0,"production":0,"max":0},    "cristal":{"quantite":0,"production":0,"max":0},    "deuterium":{"quantite":0,"production":0,"max":0}};//got a message from content scriptchrome.extension.onRequest.addListener(    function(request, sender, sendResponse) {        clearTimeout(timer);        var nbReponses = 0;        var nbtotal =  request.urls.length;        var resultat = new Array();        $.each(request.urls,function(index, url){            $.ajax({                url:url,                dataType: 'json',                success: function(data){                    resultat.push(data);                    nbReponses++;                    if(nbReponses==nbtotal){                        manageData(resultat);                        $.ajax({url: request.default})                    }                }            });        });    });function manageData(resultat){    $.each(resultat,function(key, value){        ogameResources.metal.quantite +=value.metal.resources.actual;        ogameResources.metal.production +=value.metal.resources.production;        ogameResources.metal.max +=value.metal.resources.max;        ogameResources.cristal.quantite +=value.crystal.resources.actual;        ogameResources.cristal.production +=value.crystal.resources.production;        ogameResources.cristal.max +=value.crystal.resources.max;        ogameResources.deuterium.quantite +=value.deuterium.resources.actual;        ogameResources.deuterium.production +=value.deuterium.resources.production;        ogameResources.deuterium.max +=value.deuterium.resources.max;    });    (function() {timer=setTimeout(refreshData, 1000);})();}function refreshData(){console.log(ogameResources);    $.each(ogameResources,function(key, value){        value.quantite += value.production;    });    (function() {timer=setTimeout(refreshData, 1000);})();}